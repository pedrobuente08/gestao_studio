generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Tenant {
  id               String             @id @default(cuid())
  type             TenantType
  name             String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  clients          Client[]
  fixedCosts       FixedCost[]
  linkedAsGuest    GuestLocation[]    @relation("LinkedGuest")
  guestLocations   GuestLocation[]
  procedures       Procedure[]
  seedTrainingData SeedTrainingData[]
  serviceTypes     ServiceType[]
  studioConfig     StudioConfig?
  sessions         TattooSession[]
  transactions     Transaction[]
  users            User[]
  variableCosts    VariableCost[]
  workSettings     WorkSettings?
}

model User {
  id                 String             @id @default(cuid())
  tenantId           String
  email              String             @unique
  name               String
  role               UserRole
  status             UserStatus         @default(ACTIVE)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  serviceTypeId      String?
  age                Int?
  gender             String?
  mustChangePassword Boolean            @default(false)
  profilePhotoUrl    String?
  accounts           Account[]
  mlModels           MLModel[]
  mlPredictions      MLPrediction[]
  mlTrainingData     MLTrainingData[]
  procedures         Procedure[]
  seedTrainingData   SeedTrainingData[]
  sessions           Session[]
  tattooSessions     TattooSession[]
  benefits           TatuadorBenefit[]
  serviceType        ServiceType?       @relation(fields: [serviceTypeId], references: [id])
  tenant             Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  expiresAt DateTime
  token     String   @unique
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Account {
  id                String    @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String?
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  password          String?
  emailVerified     DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model VerificationToken {
  id         String   @id @default(cuid())
  identifier String
  token      String   @unique
  expires    DateTime
  createdAt  DateTime @default(now())

  @@unique([identifier, token])
}

model StudioConfig {
  id                String            @id @default(cuid())
  tenantId          String            @unique
  defaultPercentage Int
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  tenant            Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tatuadorBenefits  TatuadorBenefit[]
}

model TatuadorBenefit {
  id             String       @id @default(cuid())
  studioConfigId String
  userId         String
  percentage     Int
  reason         String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  studioConfig   StudioConfig @relation(fields: [studioConfigId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id])
}

model GuestLocation {
  id             String          @id @default(cuid())
  tenantId       String
  name           String
  linkedTenantId String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  linkedTenant   Tenant?         @relation("LinkedGuest", fields: [linkedTenantId], references: [id])
  tenant         Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  sessions       TattooSession[]
}

model Client {
  id           String          @id @default(cuid())
  tenantId     String
  name         String
  email        String?
  phone        String?
  notes        String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  instagram    String?
  birthDate    DateTime?
  tenant       Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  sessions     TattooSession[]
  transactions Transaction[]
}

model Procedure {
  id           String           @id @default(cuid())
  tenantId     String
  userId       String
  name         String
  description  String?
  size         TattooSize
  complexity   TattooComplexity
  bodyLocation BodyLocation
  finalPrice   Int
  duration     Int
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  tenant       Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user         User             @relation(fields: [userId], references: [id])
  sessions     TattooSession[]
}

model ServiceType {
  id          String          @id @default(cuid())
  tenantId    String?
  name        String
  isSystem    Boolean         @default(false)
  createdAt   DateTime        @default(now())
  tenant      Tenant?         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  sessions    TattooSession[]
  prestadores User[]
}

model TattooSession {
  id               String            @id @default(cuid())
  tenantId         String
  clientId         String
  userId           String
  procedureId      String?
  size             TattooSize?
  complexity       TattooComplexity?
  bodyLocation     BodyLocation?
  description      String?
  finalPrice       Int
  guestLocationId  String?
  studioPercentage Int?
  studioFee        Int?
  tatuadorRevenue  Int?
  duration         Int?
  date             DateTime
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  serviceTypeId    String?
  mlTrainingData   MLTrainingData?
  client           Client            @relation(fields: [clientId], references: [id], onDelete: Cascade)
  guestLocation    GuestLocation?    @relation(fields: [guestLocationId], references: [id])
  procedure        Procedure?        @relation(fields: [procedureId], references: [id])
  serviceType      ServiceType?      @relation(fields: [serviceTypeId], references: [id])
  tenant           Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user             User              @relation(fields: [userId], references: [id])
  transaction      Transaction?
}

model Transaction {
  id            String              @id @default(cuid())
  tenantId      String
  type          TransactionType
  category      TransactionCategory
  amount        Int
  paymentMethod PaymentMethod?
  clientId      String?
  sessionId     String?             @unique
  description   String?
  date          DateTime
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  client        Client?             @relation(fields: [clientId], references: [id])
  session       TattooSession?      @relation(fields: [sessionId], references: [id])
  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model FixedCost {
  id        String   @id @default(cuid())
  tenantId  String
  name      String
  amount    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model VariableCost {
  id        String   @id @default(cuid())
  tenantId  String
  name      String
  amount    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model WorkSettings {
  id               String         @id @default(cuid())
  tenantId         String         @unique
  hoursPerMonth    Int
  profitMargin     Int
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  mode             CalculatorMode @default(AUTONOMOUS)
  studioPercentage Int?
  tenant           Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model MLTrainingData {
  id           String           @id @default(cuid())
  sessionId    String           @unique
  userId       String
  size         TattooSize
  complexity   TattooComplexity
  bodyLocation BodyLocation
  duration     Int
  finalPrice   Int
  createdAt    DateTime         @default(now())
  session      TattooSession    @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user         User             @relation(fields: [userId], references: [id])
}

model MLModel {
  id             String         @id @default(cuid())
  userId         String
  trainedAt      DateTime
  dataPointsUsed Int
  modelPath      String
  isActive       Boolean        @default(true)
  createdAt      DateTime       @default(now())
  user           User           @relation(fields: [userId], references: [id])
  predictions    MLPrediction[]
}

model MLPrediction {
  id             String           @id @default(cuid())
  userId         String
  modelId        String
  size           TattooSize
  complexity     TattooComplexity
  bodyLocation   BodyLocation
  predictedPrice Int
  acceptedPrice  Int?
  createdAt      DateTime         @default(now())
  model          MLModel          @relation(fields: [modelId], references: [id])
  user           User             @relation(fields: [userId], references: [id])
}

model SeedTrainingData {
  id           String           @id @default(cuid())
  tenantId     String
  userId       String
  size         TattooSize
  complexity   TattooComplexity
  bodyLocation BodyLocation
  finalPrice   Int
  createdAt    DateTime         @default(now())
  tenant       Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user         User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model TattooSizeScale {
  size  TattooSize @id
  level Int
}

model TattooComplexityScale {
  complexity TattooComplexity @id
  level      Int
}

model BodyLocationScale {
  bodyLocation BodyLocation @id
  level        Int
}

enum TenantType {
  AUTONOMO
  STUDIO
}

enum UserRole {
  OWNER
  STAFF
  EMPLOYEE
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum AutonomoType {
  OWN_SPACE
  GUEST
}

enum CalculatorMode {
  AUTONOMOUS
  STUDIO_PERCENTAGE
}

enum TransactionCategory {
  TATTOO
  MATERIAL
  FIXED
  MARKETING
  PRO_LABORE
  INVESTMENT
  OTHER
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum PaymentMethod {
  PIX
  CREDIT_CARD
  DEBIT_CARD
  BOLETO
  CASH
}

enum TattooSize {
  SMALL
  MEDIUM
  LARGE
  EXTRA_LARGE
  XLARGE
  FULL_BODY
  MICRO
}

enum TattooComplexity {
  LOW
  MEDIUM
  HIGH
  VERY_HIGH
}

enum BodyLocation {
  ARM
  FOREARM
  HAND
  FINGER
  UPPER_BACK
  LOWER_BACK
  FULL_BACK
  CHEST
  ABDOMEN
  SHOULDER
  NECK
  FACE
  HEAD
  THIGH
  CALF
  FOOT
  RIB
  INNER_ARM
  WRIST
  ANKLE
  OTHER
  TRAPEZIUS
  SHIN
  COLLARBONE
}
